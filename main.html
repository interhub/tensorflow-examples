<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>linear regression with tensorflow</title>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.11.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.3.1/lib/p5.min.js"></script>

    <script>
        // Daniel Shiffman
        // http://codingtra.in
        // http://patreon.com/codingtrain

        // Linear Regression with TensorFlow.js
        // Video: https://www.youtube.com/watch?v=dLp10CFIvxI

        let x_vals = [0.1, 0.2, 0.3, 0.4, 0.6]
        let y_vals = [0.2, 0.4, 0.6, 0.8, 1.2]

        const learningRate = 0.3

        /**
         * main model set up config
         */
        const getSetUpModel = () => {
            const model = tf.sequential()
            const inputShape = [1]
            const units = 1

            model.add(tf.layers.dense({units, inputShape}))
            model.add(tf.layers.dense({units}))
            model.compile({loss: 'meanSquaredError', optimizer: tf.train.sgd(learningRate)})
            return model
        }

        const model = getSetUpModel()

        /**
         * main fit method
         */
        async function fit() {
            const xs = tf.tensor(x_vals, [5, 1])
            const ys = tf.tensor(y_vals, [5, 1])
            await model.fit(xs, ys, {
                epochs: 250,
                // yieldEvery: 'never',
            })
        }

        const start = async () => {
            console.log('start run')
            await fit()
            const input = [4000]
            const predictX = tf.tensor(input, [1, 1])
            console.log('end fit run')
            predictX.print()
            const res = await model.predict(predictX).dataSync()
            res.forEach(console.log)
        }

        start()


    </script>
</head>
<body>
</body>
</html>
